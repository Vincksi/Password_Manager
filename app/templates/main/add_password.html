{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h1>Add New Password</h1>
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <form method="POST" action="">
                        {{ form.hidden_tag() }}
                        
                        <div class="mb-3">
                            {{ form.title.label(class="form-label") }}
                            {{ form.title(class="form-control") }}
                            {% for error in form.title.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>

                        <div class="mb-3">
                            {{ form.username.label(class="form-label") }}
                            {{ form.username(class="form-control") }}
                            {% for error in form.username.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>

                        <div class="mb-3">
                            {{ form.password.label(class="form-label") }}
                            <div class="input-group">
                                <input type="password" class="form-control" id="password" name="password" autocomplete="new-password">
                                <button class="btn btn-outline-secondary view-password" type="button" onclick="console.log('Button clicked via onclick')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            {% for error in form.password.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>

                        <!-- Password Strength Indicator -->
                        <div class="mb-3">
                            <div class="progress" style="height: 5px;">
                                <div id="password-strength" class="progress-bar" role="progressbar" style="width: 0%"></div>
                            </div>
                            <small id="strength-text" class="form-text"></small>
                            <ul id="suggestions-list" class="list-unstyled mt-2"></ul>
                        </div>

                        <div class="mb-3">
                            {{ form.url.label(class="form-label") }}
                            {{ form.url(class="form-control") }}
                            {% for error in form.url.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>

                        <div class="mb-3">
                            {{ form.notes.label(class="form-label") }}
                            {{ form.notes(class="form-control", rows=3) }}
                            {% for error in form.notes.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>

                        <div class="d-grid">
                            {{ form.submit(class="btn btn-primary") }}
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Password Generator</h5>
                    <form id="generator-form">
                        <div class="mb-3">
                            <label for="length" class="form-label">Password Length</label>
                            <input type="number" class="form-control" id="length" name="length" min="8" max="64" value="16">
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="include_uppercase" name="include_uppercase" checked>
                                <label class="form-check-label" for="include_uppercase">
                                    Include Uppercase Letters
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="include_lowercase" name="include_lowercase" checked>
                                <label class="form-check-label" for="include_lowercase">
                                    Include Lowercase Letters
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="include_numbers" name="include_numbers" checked>
                                <label class="form-check-label" for="include_numbers">
                                    Include Numbers
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="include_special" name="include_special" checked>
                                <label class="form-check-label" for="include_special">
                                    Include Special Characters
                                </label>
                            </div>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-secondary">Generate Password</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Spinner -->
<div class="spinner" style="display: none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

<!-- Flash Messages Container -->
<div class="flash-messages"></div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Template script loaded');
    const viewPasswordBtn = document.querySelector('.view-password');
    console.log('View password button in template:', viewPasswordBtn);
    
    if (viewPasswordBtn) {
        viewPasswordBtn.addEventListener('click', function(e) {
            console.log('Button clicked in template');
            e.preventDefault();
            
            const passwordField = document.getElementById('password');
            console.log('Password field in template:', passwordField);
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                this.querySelector('i').classList.remove('fa-eye');
                this.querySelector('i').classList.add('fa-eye-slash');
            } else {
                passwordField.type = 'password';
                this.querySelector('i').classList.remove('fa-eye-slash');
                this.querySelector('i').classList.add('fa-eye');
            }
        });
    }
});
</script>
{% endblock %}